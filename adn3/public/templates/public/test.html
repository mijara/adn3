{% extends 'base.html' %}
{% block breadcrump %}
  <!-- Left Blank -->
{% endblock %}
{% block container %}
    <div class="row">
        <div class="col-sm-12">
          <h1 class="header">{{ version }}</h1>
        </div>
        <div id="student-test" class="col-sm-12">
            <div class="progress">
              <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 0%;">
              </div>
              <span class="text-success">Tiempo restante: <span class="time-out">{{ version.test.timeout }}</span> minutos</span>
            </div>
            <form action="" method="GET">
                <input type="hidden" name="version" value="{{ version.pk }}">
                {% for question in version.question_set.all %}
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <strong>{{ forloop.counter }}.-</strong>
                            <div class="question-statement">
                              <i>[{{ question.score }}pts] </i>
                              {{ question.html|safe }}
                            </div>
                            <hr>
                            {% if question.choicequestion %}
                                {% include 'public/_choice_answers.html' %}
                            {% elif question.numericalquestion %}
                                {% include 'public/_numerical_limits.html' %}
                            {% elif question.textquestion %}
                                {% include 'public/_text_answer.html' %}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
                <div class="form-group">
                    <input type="submit" class="btn btn-primary" role="button">
                </div>
            </form>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12">
          <div class="list-group">
            {% for course in course_list %}
              {% if course.status %}
                <a href="{% url 'public:course_detail' course.pk %}" class="list-group-item">
                  {{ course }}
                </a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="modalLabel">Lo sentimos</h4>
          </div>
          <div class="modal-body">
            <p>Has superado el tiempo límite. Se enviarán las respuestas que tengas hasta el momento.</p>
          <div class="modal-footer">
            <a href="/public" type="button" class="btn btn-default">Ir al inicio</a>
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block script %}
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          messageStyle: "none"
        });
    </script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=default">
    </script>
    <script>
        var minutes = {{ version.test.timeout }};
        var startedAt, duration = minutes*60000;

        function start() {
          startedAt = Date.now();
          updateTarget(0);
          requestAnimationFrame(update);
        }

        function update() {
          let elapsedTime = Date.now() - startedAt;

          // playback is a value between 0 and 1
          // being 0 the start of the animation and 1 its end
          let playback = elapsedTime / duration;

          updateTarget(playback)

          if (playback > 0 && playback < 1) {
            // Queue the next frame
            requestAnimationFrame(update);
          } else {
            $('#modal').modal({backdrop: 'static', keyboard: false});
          }
        }

        function updateTarget(playback) {
          // Uncomment the line below to reverse the animation
          // playback = 1 - playback
          // Update the target properties based on the playback position
          if ((Date.now() - startedAt)%60000 == 0 && (Date.now() - startedAt) != 0) {
              $('.time-out').html(--minutes);
          }
          $('.progress-bar').css('min-width', playback*100 + '%');
        }

        start()
    </script>
{% endblock %}
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<!-- <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
</body>
</html>
